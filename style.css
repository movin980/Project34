import { db } from "./firebase-config.js";
import { collection, addDoc, getDocs } from "firebase/firestore";

const customerForm = document.getElementById("customerForm");
const customerList = document.getElementById("customerList");

// Add Customer to Firestore
customerForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const last_purchase_date = document.getElementById("last_purchase_date").value;
  const total_spent = Number(document.getElementById("total_spent").value);
  const visits = Number(document.getElementById("visits").value);

  try {
    await addDoc(collection(db, "customers"), {
      name,
      email,
      last_purchase_date,
      total_spent,
      visits,
      churn_risk: "Unknown" // later AI will update this
    });

    alert("âœ… Customer added successfully!");
    customerForm.reset();
    loadCustomers();
  } catch (error) {
    console.error("Error adding customer:", error);
  }
});

// Load Customers
async function loadCustomers() {
  customerList.innerHTML = "";
  const querySnapshot = await getDocs(collection(db, "customers"));

  querySnapshot.forEach((doc) => {
    const customer = doc.data();
    customerList.innerHTML += `
      <tr>
        <td>${customer.name}</td>
        <td>${customer.email}</td>
        <td>${customer.last_purchase_date}</td>
        <td>${customer.total_spent}</td>
        <td>${customer.visits}</td>
        <td>${customer.churn_risk}</td>
      </tr>
    `;
  });
}

// Load customers on page load
loadCustomers();
